---
title: "Week 12: Survival Analysis"
subtitle: "*DSAN 5300: Statistical Learning*<br><span class='subsubtitle'>Spring 2025, Georgetown University</span>"
author: "Jeff Jacobs"
institute: "[`jj1088@georgetown.edu`](mailto:jj1088@georgetown.edu)"
bibliography: "../_DSAN5300.bib"
date: 2025-04-07
date-format: full
lecnum: 12
categories:
  - "Class Sessions"
format:
  revealjs:
    df-print: kable
    footer: "DSAN 5300-01 Week 12: {{< var w12.footer >}}"
    output-file: "slides.html"
    html-math-method: mathjax
    scrollable: true
    theme: [default, "../dsan-globals/jjquarto.scss"]
    slide-number: true
    echo: true
    code-fold: true
    link-external-icon: true
    link-external-newwindow: true
    include-in-header:
      text: "<link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css'><link rel='stylesheet' type='text/css' href='https://cdn.jsdelivr.net/gh/dreampulse/computer-modern-web-font@master/fonts.css'>"
    simplemenu:
      flat: true
      barhtml:
        header: "<div class='menubar'><span style='position: absolute; left: 8; padding-left: 8px;'><a href='./index.html'>&larr; Return to Notes</a></span><ul class='menu'></ul></div>"
      scale: 0.5
    revealjs-plugins:
      - simplemenu
  html:
    df-print: kable
    output-file: "index.html"
    html-math-method: mathjax
    echo: true
    code-fold: true
---

::: {.content-visible unless-format="revealjs"}

<center class='mb-3'>
<a class="h2" href="./slides.html" target="_blank">Open slides in new tab &rarr;</a>
</center>

:::

# Schedule {.smaller .small-title .crunch-title .crunch-callout data-stack-name="Schedule"}

Today's Planned Schedule:

| | Start | End | Topic |
|:- |:- |:- |:- |
| **Lecture** | 6:30pm | 7:00pm | [Single Layer Neural Networks &rarr;](#learning-decision-boundaries) |
| | 7:00pm | 7:20pm | [Max-Margin Classifiers &rarr;](#max-margin-classifiers) | 
| | 7:20pm | 8:00pm | [Support Vector *Classifiers* &rarr;](#support-vector-classifiers) |
| **Break!** | 8:00pm | 8:10pm | |
| | 8:10pm | 9:00pm | [Fancier Neural Networks &rarr;](#quiz-time) |

: {tbl-colwidths="[12,12,12,64]"}

::: {.hidden}

```{r}
#| label: r-source-globals
source("../dsan-globals/_globals.r")
set.seed(5300)
```

:::

{{< include ../dsan-globals/_globals-tex.qmd >}}

## Roadmap {.crunch-title .crunch-ul}

* <i class='bi bi-1-circle'></i> Basic tool: **survival curve** $S(t)$ = probability of surviving past period $t$
* Complicating factor: **Censored** obs (e.g., drop out of study)
* $\Rightarrow$ Need to think about **DGP**: *Why* is observation $i$ censored while $j$ is observed?
    * Basic estimators only valid if censoring $\perp$ survival time
* <i class='bi bi-2-circle'></i> How to compare survival **between two groups**
* <i class='bi bi-3-circle'></i> Regression: Effect of features $X_1, \ldots, X_p$ on survival

# Survival Analysis Basics {.smaller .title-12 data-stack-name="Survival Analysis"}

* Lots of information crunched into this one figure!

![ISLR Figure 11.1](images/11_1.svg){fig-align="center"}

## Read Left to Right $\Rightarrow$ Sequence of Events {.smaller .crunch-title .title-11}

![Modified ISLR Figure 11.1](images/Survival_Plot.png){fig-align="center"}

## "Slice" at Deaths $\Rightarrow$ At-Risk Observations {.smaller .crunch-title .title-11}

![Modified ISLR Figure 11.1](images/Survival_Plot_Slices.png){fig-align="center"}

## The Actual Dataset We Get {.smaller .crunch-title .title-11}

| Patient ($i$) | Observed Outcome ($Y_i$) | Observed? ($\delta_i$) |
|:-:|:-:|:-:|
| 1 | 300 | 1 |
| 2 | 365 | 0 |
| 3 | 150 | 1 |
| 4 | 250 | 0 |

![](images/11_1.svg){fig-align="center"}

## The Dataset We Can Infer {.smaller .crunch-title .title-11}

| Patient ($i$) | $Y_i$ | $\delta_i$ | Survival Time ($T_i$) | Censor Point ($C_i$) |
|:-:|:-:|:-:|:-:|:-:|
| 1 | 300 | 1 | 300 | `NA` |
| 2 | 365 | 0 | `NA` | 365 |
| 3 | 150 | 1 | 150 | `NA` |
| 4 | 250 | 0 | `NA` | 250 |

: {tbl-colwidths="[20,10,10,30,30]"}

...If we're testing effect of treatment, which column do we most care about?

![](images/11_1.svg){fig-align="center"}

## Measuring Effect of Treatment! {.smaller .crunch-title .title-11}

```{=html}
<style>
.tab-surv tr td:nth-child(4), .tab-surv tr th:nth-child(4) {
    border-left: 2px solid #E69F00 !important;
    border-right: 2px solid #E69F00 !important;
    background-color: #E69F0050 !important;
}
.tab-surv tr:first-child th:nth-child(4) {
    border-top: 2px solid #E69F00 !important;
}
.tab-surv tr:nth-child(4) td:nth-child(4) {
    border-bottom: 2px solid #E69F00 !important;
}
</style>
```

| Patient ($i$) | $Y_i$ | $\delta_i$ | Survival Time ($T_i$) | Censor Point ($C_i$) |
|:-:|:-:|:-:|:-:|:-:|
| 1 | 300 | 1 | 300 | `NA` |
| 2 | 365 | 0 | `NA` | 365 |
| 3 | 150 | 1 | 150 | `NA` |
| 4 | 250 | 0 | `NA` | 250 |

: {.tab-surv tbl-colwidths="[20,10,10,30,30]"}

...If we're testing effect of treatment, [$T_i$ is what we care about!]{.cb1a-bg style="border: 2px solid #E69F00; padding: 5px !important;"}

![](images/11_1.svg){fig-align="center"}

## Basic Question 1: Survival {.crunch-title .math-90 .inline-90}

* Let $T$ be a RV representing time of death for a patient
* What is probability that patient **survives** past given time $t$?

$$
S_T(t) = \Pr(T > t)
$$

* Note relationship to something you saw in 5100!
* $S_T(t)$ defined to be $1 - F_T(t)$, where $F_T(t)$ is **CDF** of $T$:

$$
F_T(t) = \Pr(T \leq t)
$$

## Kaplan-Meier Estimator: Intuition {.smaller .crunch-title .title-10 .crunch-math .crunch-ul .crunch-quarto-figure .crunch-img .math-90 .inline-90 .crunch-li-5}

Each death event $d_k$ gives us **info** that survival probability lower by some amount

<i class='bi bi-1-circle'></i> Break $S(t)$ into **sequence of stepwise changes** at $d_1, \ldots, d_K$:

$$
\begin{align*}
S(d_k) = \Pr(T > d_k) &\overset{\mathclap{\small\text{LTP}}}{=} \Pr(T > d_k \mid T > d_{k-1})\overbrace{\Pr(T > d_{k-1})}^{S(d_{k-1})} \\
&\phantom{=} \; \; + \underbrace{\Pr(T > d_k \mid T \leq d_{k-1})}_{\text{Contradiction} \implies \Pr = 0}\Pr(T \leq d_{k-1})
\end{align*}
$$

:::: {.columns}
::: {.column width="50%"}

<i class='bi bi-2-circle'></i> Gives us a *recurrence relation*:

$$
\begin{align*}
S(d_k) &= \Pr(T > d_k \mid T > d_{k-1})S(d_{k-1}) \\
S(d_{k-1}) &= \Pr(T > d_{k-1} \mid T > d_{k-2})S(d_{k-2}) \\
%S(d_{k-2}) &= \Pr(T > d_{k-2} \mid T > d_{k-3})S(d_{k-3}) \\
&\vdots \\
S(d_2) &= \Pr(T > d_2 \mid T > d_1)S(d_1) \\
S(d_1) &= \Pr(T > d_1 \mid T > d_0)S(d_0) = \Pr(T > d_1)
\end{align*}
$$

:::
::: {.column width="50%"}

<i class='bi bi-3-circle'></i> Plug each eq into eq above it to derive:

$$
\begin{align*}
S(d_k) = &\Pr(\underbrace{T > d_k}_{\mathclap{\small\text{Survives past }d_k}} \; \mid \; \underbrace{T > d_{k-1}}_{\mathclap{\small\text{Survives past }d_{k-1}}}) \\
&\times \Pr(\underbrace{T > d_{k-1}}_{\small\text{Survives past }d_{k-1}} \mid \underbrace{T > d_{k-2}}_{\small\text{Survives past }d_{k-2}}) \\
&\times \cdots \times \Pr(\underbrace{T > d_2}_{\mathclap{\small\text{Survives past }d_2}} \; \mid \; \underbrace{T > d_1}_{\mathclap{\small\text{Survives past }d_1}}) \\
&\times \Pr(\underbrace{T > d_1}_{\mathclap{\small\text{Survives past }d_1}})
\end{align*}
$$

:::
::::

## Kaplan-Meier Estimator {.smaller .crunch-title .title-11 .crunch-math .crunch-ul .crunch-quarto-figure .crunch-img}

* Defined **at** death points $d_k$ as

$$
\widehat{S}(d_k) = \prod_{j=1}^{k} \Bigl(
    \overbrace{
        \frac{
            r_j - q_j
        }{
            \underbrace{r_j}_{\mathclap{\small\text{Num At Risk}}}
        }
    }^{\mathclap{\small\text{Num Survived}}}
\Bigr)
$$

* Then, for $t \in (d_k, d_{k+1})$, $\widehat{S}(t) = \widehat{S}(d_k)$, producing **stepwise** survival function:

![ISLR Figure 11.2](images/11_2.svg){fig-align="center"}